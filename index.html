<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Phaser Pokelike</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
  body { margin:0; background:#000; overflow:hidden; }
  canvas { image-rendering: pixelated; }
</style>

<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: 320,
    height: 240,
    zoom: 2,
    pixelArt: true,
    physics: {
        default: 'arcade',
        arcade: { debug: false }
    },
    scene: { preload, create, update }
};

let player, cursors, doors = [];

new Phaser.Game(config);

function preload() {
    this.load.image("big_map", "assets/big_map.png");  // ← big_map.png に置き換えておく
    this.load.spritesheet("player", "assets/player_fixed.png", {
        frameWidth: 32,
        frameHeight: 32
    });
}

function create() {
    //----------------------------------------------------------------
    // マップ（1024×1024想定だけど、あなたの big_map に合わせて自動調整）
    //----------------------------------------------------------------
    const bg = this.add.image(0, 0, "big_map").setOrigin(0, 0);

    // プレイヤー
    player = this.physics.add.sprite(200, 300, "player");
    player.setCollideWorldBounds(true);

    // カメラ設定
    this.cameras.main.startFollow(player, true, 0.1, 0.1);
    this.cameras.main.setBounds(0, 0, bg.width, bg.height);
    this.physics.world.setBounds(0, 0, bg.width, bg.height);

    //----------------------------------------------------------------
    // アニメーション
    //----------------------------------------------------------------
    this.anims.create({
        key:"down",
        frames: this.anims.generateFrameNumbers("player",{ start:0, end:2 }),
        frameRate: 8,
        repeat:-1
    });
    this.anims.create({
        key:"left",
        frames: this.anims.generateFrameNumbers("player",{ start:3, end:5 }),
        frameRate: 8,
        repeat:-1
    });
    this.anims.create({
        key:"right",
        frames: this.anims.generateFrameNumbers("player",{ start:6, end:8 }),
        frameRate: 8,
        repeat:-1
    });
    this.anims.create({
        key:"up",
        frames: this.anims.generateFrameNumbers("player",{ start:9, end:11 }),
        frameRate: 8,
        repeat:-1
    });

    cursors = this.input.keyboard.createCursorKeys();

    //----------------------------------------------------------------
    // ★ 扉（見えない当たり判定）
    //----------------------------------------------------------------
    // 位置は仮。あとであなたのマップ配置に合わせて微調整する！

    // 自宅
    doors.push( makeDoor(this, 120, 360, "home") );

    // BANK
    doors.push( makeDoor(this, 600, 300, "bank") );

    // MART
    doors.push( makeDoor(this, 750, 300, "mart") );

    // CINEMA
    doors.push( makeDoor(this, 900, 300, "cinema") );

    // overlap 登録
    doors.forEach(door => {
        this.physics.add.overlap(player, door.zone, () => {
            door.onEnter();
        });
    });

    //----------------------------------------------------------------
    // 扉イベント（メッセージ表示）
    //----------------------------------------------------------------
    this.infoText = this.add.text(10, 10, "", {
        fontSize: "12px",
        fill: "#fff",
        backgroundColor: "rgba(0,0,0,0.4)"
    }).setScrollFactor(0);
}

function update() {
    const speed = 90;
    player.setVelocity(0);

    if (cursors.left.isDown) {
        player.setVelocityX(-speed);
        player.anims.play("left", true);
    } else if (cursors.right.isDown) {
        player.setVelocityX(speed);
        player.anims.play("right", true);
    } else if (cursors.up.isDown) {
        player.setVelocityY(-speed);
        player.anims.play("up", true);
    } else if (cursors.down.isDown) {
        player.setVelocityY(speed);
        player.anims.play("down", true);
    } else {
        player.anims.stop();
    }
}

//--------------------------------------------------------------------
// 扉オブジェクトを作る関数（見えない当たり判定）
//--------------------------------------------------------------------
function makeDoor(scene, x, y, name) {
    const zone = scene.add.zone(x, y, 32, 32);
    scene.physics.world.enable(zone);
    zone.body.setAllowGravity(false);
    zone.body.moves = false;

    return {
        zone,
        onEnter() {
            scene.infoText.setText(name.toUpperCase() + " に入る！（後で内部マップ作成）");
            console.log(name + " 入った");
        }
    };
}
</script>

</body>
</html>
