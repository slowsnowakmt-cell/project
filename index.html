<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Phaser Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
  body { margin:0; background:#000; overflow:hidden; }
  canvas { image-rendering: pixelated; }
</style>

<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: 320,
    height: 240,
    zoom: 2,
    pixelArt: true,
    physics: {
        default: 'arcade',
        arcade: { debug: false }
    },
    scene: { preload, create, update }
};

let player, cursors, infoText;

new Phaser.Game(config);

// -----------------------------------------------
//  扉位置（縮小後座標）
// -----------------------------------------------
const DOORS = {
    HOME:   { x:145, y:198 },
    BANK:   { x:546, y:200 },
    MART:   { x:586, y:363 },
    CINEMA: { x:387, y:466 }
};

function preload() {
    this.load.image("map", "assets/map.png");  // ← big_map_scaled.png に差し替え済み
    this.load.spritesheet("player", "assets/player_fixed.png", {
        frameWidth: 32,
        frameHeight: 32
    });
}

function create() {

    //----------------------------------------------------------------
    // マップ表示（縮小後 768×512）
    //----------------------------------------------------------------
    const bg = this.add.image(0, 0, "map").setOrigin(0, 0);

    //----------------------------------------------------------------
    // プレイヤー配置
    //----------------------------------------------------------------
    player = this.physics.add.sprite(150, 170, "player");
    player.setCollideWorldBounds(true);

    //----------------------------------------------------------------
    // カメラ追従
    //----------------------------------------------------------------
    this.cameras.main.startFollow(player, true, 0.1, 0.1);
    this.cameras.main.setBounds(0, 0, bg.width, bg.height);
    this.physics.world.setBounds(0, 0, bg.width, bg.height);

    //----------------------------------------------------------------
    // アニメーション
    //----------------------------------------------------------------
    this.anims.create({
        key:"down",
        frames: this.anims.generateFrameNumbers("player",{ start:0, end:2 }),
        frameRate: 8,
        repeat:-1
    });
    this.anims.create({
        key:"left",
        frames: this.anims.generateFrameNumbers("player",{ start:3, end:5 }),
        frameRate: 8,
        repeat:-1
    });
    this.anims.create({
        key:"right",
        frames: this.anims.generateFrameNumbers("player",{ start:6, end:8 }),
        frameRate: 8,
        repeat:-1
    });
    this.anims.create({
        key:"up",
        frames: this.anims.generateFrameNumbers("player",{ start:9, end:11 }),
        frameRate: 8,
        repeat:-1
    });

    cursors = this.input.keyboard.createCursorKeys();

    //----------------------------------------------------------------
    // 扉の見えない当たり判定
    //----------------------------------------------------------------
　　Object.entries(DOORS).forEach(([name, pos]) => {
    const zone = this.add.zone(pos.x, pos.y, 40, 40);
    this.physics.world.enable(zone);
    zone.body.setAllowGravity(false);
    zone.body.moves = false;

    this.physics.add.overlap(player, zone, () => {
        infoText.setText(`${name} に入る（内部はこれから作る）`);
        console.log(`${name} 入り`);
    　});
　　});
    //----------------------------------------------------------------
    // 情報テキスト
    //----------------------------------------------------------------
    infoText = this.add.text(10, 10, "", {
        fontSize: "12px",
        fill: "#fff",
        backgroundColor: "rgba(0,0,0,0.4)"
    }).setScrollFactor(0);
}

function update() {
    const speed = 100;
    player.setVelocity(0);

    if (cursors.left.isDown) {
        player.setVelocityX(-speed);
        player.anims.play("left", true);
    }
    else if (cursors.right.isDown) {
        player.setVelocityX(speed);
        player.anims.play("right", true);
    }
    else if (cursors.up.isDown) {
        player.setVelocityY(-speed);
        player.anims.play("up", true);
    }
    else if (cursors.down.isDown) {
        player.setVelocityY(speed);
        player.anims.play("down", true);
    }
    else {
        player.anims.stop();
    }
}
</script>

</body>
</html>
